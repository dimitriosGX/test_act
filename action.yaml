name: 'Hackbot CI'
description: 'Hackbot action'

inputs:
  bot_address:
    description: 'The address of the bot to hack'
    required: false
    default: 'localhost'
  bot_port:
    description: 'The port of the bot to hack'
    required: false
    default: '5000'
  token:
    description: 'The token to use to authenticate with the bot'
    required: true

runs:
  using: "composite"
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        cache: 'pip' 
        python-version: '3.12'

    - name: Install dependencies
      shell: bash
      run: |
        python -m pip install aiohttp requests

    - name: Hack the contract
      id: hack_contract
      shell: bash
      run: |       
        ${{ github.action_path }}/src/compress.sh
        results=$(python ${{ github.action_path }}/src/bot_api.py \
          --bot_address ${{ inputs.bot_address }} \
          --bot_port ${{ inputs.bot_port }} \
          --token ${{ inputs.token }})
        
        # Set the output for GitHub Actions
        echo "results=$results" >> $GITHUB_OUTPUT
        
        # Print the contents of GITHUB_OUTPUT
        echo "Contents of GITHUB_OUTPUT:"
        cat $GITHUB_OUTPUT
        
        # Test print the output
        echo "Hack results:"
        echo "$results"

    - name: Debug Output
      shell: bash
      run: |
        echo "Debug: Checking step output"
        echo "${{ steps.hack_contract.outputs.results }}"

outputs:
  hack_results:
    description: "The results of the hack"
    value: ${{ steps.hack_contract.outputs.results }}
